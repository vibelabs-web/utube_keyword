# T0.5.1 - API 계약 정의 (Pydantic Schemas) 완료 보고서

## 태스크 개요
키워드 분석 및 댓글 분석 API의 Request/Response 스키마를 Pydantic v2로 정의

## 구현 완료 항목

### 1. 공통 스키마 (`app/schemas/common.py`)
- `ApiResponse[T]`: Generic 타입을 사용한 공통 API 응답 래퍼
  - `success`: 요청 성공 여부
  - `data`: 응답 데이터 (Generic 타입)
  - `error`: 에러 메시지
  - `timestamp`: 응답 타임스탬프

- `PaginatedResponse[T]`: 페이지네이션 지원 응답
  - `total`: 전체 아이템 수
  - `page`: 현재 페이지
  - `page_size`: 페이지당 아이템 수
  - `data`: 현재 페이지 아이템 리스트

### 2. 키워드 스키마 (`app/schemas/keyword.py`)

#### Request
- `KeywordAnalyzeRequest`
  - `keyword`: 분석할 키워드 (1-100자, 공백 검증)

#### Response
- `KeywordMetrics`
  - `search_volume`: 검색량 (>= 0)
  - `competition`: 경쟁도 (0.0-1.0)
  - `recommendation_score`: 추천 점수 (0.0-1.0)

- `RelatedKeyword`
  - `keyword`: 연관 키워드
  - `search_volume`: 검색량
  - `competition`: 경쟁도

- `KeywordAnalyzeResponse`
  - `keyword`: 분석된 키워드
  - `metrics`: 키워드 메트릭
  - `related_keywords`: 연관 키워드 리스트 (최대 10개)
  - `analyzed_at`: 분석 타임스탬프

### 3. 댓글 스키마 (`app/schemas/comment.py`)

#### Request
- `CommentAnalyzeRequest`
  - `video_url`: YouTube URL (정규식 검증)
    - 지원 형식: youtube.com/watch?v=..., youtu.be/..., youtube.com/embed/...

#### Response
- `VideoInfo`
  - `video_id`: YouTube 비디오 ID
  - `title`: 비디오 제목 (최대 200자)
  - `channel_title`: 채널명 (최대 100자)
  - `view_count`: 조회수
  - `comment_count`: 댓글 수

- `FrequentWord`
  - `word`: 빈출 단어/구문 (최대 50자)
  - `count`: 출현 횟수
  - `percentage`: 비율 (0.0-100.0)

- `ViewerRequest`
  - `text`: 요청/피드백 텍스트 (최대 500자)
  - `like_count`: 좋아요 수
  - `author`: 작성자명 (최대 100자)

- `SentimentAnalysis`
  - `positive`: 긍정 비율 (0.0-1.0)
  - `neutral`: 중립 비율 (0.0-1.0)
  - `negative`: 부정 비율 (0.0-1.0)
  - `total_analyzed`: 분석된 댓글 수

- `CommentAnalyzeResponse`
  - `video_info`: 비디오 정보
  - `frequent_words`: 빈출 단어 리스트 (최대 20개)
  - `viewer_requests`: 시청자 요청 리스트 (최대 10개)
  - `sentiment`: 감정 분석 결과
  - `analyzed_at`: 분석 타임스탬프

## Pydantic v2 기능 활용

### 1. ConfigDict 사용
```python
model_config = ConfigDict(
    json_schema_extra={
        "examples": [...]
    }
)
```

### 2. Field 검증
- `min_length` / `max_length`: 문자열 길이 제한
- `ge` / `le`: 숫자 범위 제한
- `default_factory`: 기본값 생성
- `description`: 필드 설명
- `examples`: 예시 데이터

### 3. Custom Validators
- `@field_validator`: 커스텀 검증 로직
  - 키워드 공백 제거 및 검증
  - YouTube URL 형식 검증 (정규식)
  - Sentiment 값 범위 검증

### 4. Type Hints
- Python 3.9 호환성: `Optional[T]`, `List[T]` 사용
- Generic 타입: `ApiResponse[T]`, `PaginatedResponse[T]`

## API 엔드포인트

### 생성된 엔드포인트
1. `POST /api/v1/keywords/analyze`
   - Request: `KeywordAnalyzeRequest`
   - Response: `ApiResponse[KeywordAnalyzeResponse]`

2. `POST /api/v1/comments/analyze`
   - Request: `CommentAnalyzeRequest`
   - Response: `ApiResponse[CommentAnalyzeResponse]`

3. `GET /`
   - Health check 엔드포인트

## 검증 완료

### 1. 스키마 검증 (`test_schemas.py`)
- 모든 Request/Response 스키마 생성 검증
- Field validation 동작 확인
- JSON Schema 생성 확인
- Examples 포함 여부 확인

### 2. API 검증 (`test_api_endpoints.py`)
- Health check 엔드포인트 동작 확인
- Request validation 동작 확인
  - 유효한 입력: 정상 처리 (501 - 미구현)
  - 빈 값: 422 Validation Error
  - 길이 초과: 422 Validation Error
  - 잘못된 형식: 422 Validation Error
- OpenAPI 스키마 생성 확인

### 3. OpenAPI 문서 생성
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`
- OpenAPI JSON: `http://localhost:8000/openapi.json`

## 프로젝트 구조

```
backend/
├── app/
│   ├── __init__.py
│   ├── api/
│   │   ├── __init__.py
│   │   └── v1/
│   │       ├── __init__.py
│   │       └── endpoints.py     # API 엔드포인트
│   └── schemas/
│       ├── __init__.py           # 스키마 export
│       ├── common.py             # 공통 스키마
│       ├── keyword.py            # 키워드 스키마
│       └── comment.py            # 댓글 스키마
├── main.py                       # FastAPI 앱
├── test_schemas.py               # 스키마 검증 테스트
├── test_api_endpoints.py         # API 검증 테스트
└── openapi.json                  # 생성된 OpenAPI 스키마
```

## 테스트 결과

### 스키마 검증
```
All schema tests passed! ✓
```

### API 검증
```
All API tests passed! ✓

Endpoints:
  POST /api/v1/keywords/analyze
  POST /api/v1/comments/analyze
  GET /

Schemas defined: 14
  ✓ KeywordAnalyzeRequest
  ✓ KeywordAnalyzeResponse
  ✓ CommentAnalyzeRequest
  ✓ CommentAnalyzeResponse
  ✓ ApiResponse_KeywordAnalyzeResponse_
  ✓ ApiResponse_CommentAnalyzeResponse_
```

## 다음 단계 제안

### T0.5.2 - 서비스 레이어 구현
1. `app/services/keyword_service.py`
   - 키워드 분석 로직 구현
   - 검색량 추정 알고리즘
   - 경쟁도 계산
   - 연관 키워드 추출

2. `app/services/comment_service.py`
   - YouTube API 연동
   - 댓글 크롤링
   - 텍스트 분석 (형태소 분석, 빈출 단어)
   - 감정 분석
   - 요청사항 추출

### T0.5.3 - 데이터베이스 모델
1. 분석 결과 캐싱
2. 사용자 히스토리
3. 통계 데이터

## 완료 조건 체크리스트
- [x] 모든 Request/Response 스키마 정의 완료
- [x] Pydantic v2 ConfigDict 사용
- [x] Field() validation 적용
- [x] Examples 포함
- [x] FastAPI 서버 실행 성공
- [x] /docs에서 OpenAPI 문서 확인 가능
- [x] 스키마 validation 동작 확인
- [x] Python 3.9 호환성 확인
- [x] 테스트 스크립트 작성 및 검증

## 결론
T0.5.1 태스크가 성공적으로 완료되었습니다. 모든 스키마가 Pydantic v2 규격에 맞게 정의되었으며, FastAPI의 자동 문서 생성 기능을 통해 완전한 OpenAPI 문서가 생성되었습니다. 프론트엔드 개발자는 이제 `/docs` 엔드포인트를 통해 API 계약을 확인할 수 있습니다.
